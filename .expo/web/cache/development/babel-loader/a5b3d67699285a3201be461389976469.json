{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\nimport React, { useState, useEffect, Component } from \"react\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport PermissionsAndroid from \"react-native-web/dist/exports/PermissionsAndroid\";\nimport MapView, { Marker, AnimatedRegion, Polyline, PROVIDER_GOOGLE } from \"react-native-maps\";\nimport * as Location from \"expo-location\";\nimport haversine from \"haversine\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar styles = StyleSheet.create({\n  container: _objectSpread(_objectSpread({}, StyleSheet.absoluteFillObject), {}, {\n    justifyContent: \"flex-end\",\n    alignItems: \"center\"\n  }),\n  map: _objectSpread({}, StyleSheet.absoluteFillObject),\n  bubble: {\n    flex: 1,\n    backgroundColor: \"rgba(255,255,255,0.7)\",\n    paddingHorizontal: 18,\n    paddingVertical: 12,\n    borderRadius: 20\n  },\n  latlng: {\n    width: 200,\n    alignItems: \"stretch\"\n  },\n  button: {\n    width: 80,\n    paddingHorizontal: 12,\n    alignItems: \"center\",\n    marginHorizontal: 10\n  },\n  buttonContainer: {\n    flexDirection: \"row\",\n    marginVertical: 20,\n    backgroundColor: \"transparent\"\n  }\n});\nvar LATITUDE_DELTA = 0.009;\nvar LONGITUDE_DELTA = 0.009;\nvar LATITUDE = 37.78825;\nvar LONGITUDE = -122.4324;\nvar MIN_DISTANCE = 0.05;\nfunction MyMapScreen(props) {\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    position = _useState2[0],\n    setPosition = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    errorMsg = _useState4[0],\n    setErrorMsg = _useState4[1];\n  var _useState5 = useState([]),\n    _useState6 = _slicedToArray(_useState5, 2),\n    routeCoordinates = _useState6[0],\n    setRouteCoordinates = _useState6[1];\n  var _useState7 = useState(0),\n    _useState8 = _slicedToArray(_useState7, 2),\n    distanceTraveled = _useState8[0],\n    setDistanceTraveled = _useState8[1];\n  var _useState9 = useState({}),\n    _useState10 = _slicedToArray(_useState9, 2),\n    prevPosition = _useState10[0],\n    setPrevPosition = _useState10[1];\n  var _useState11 = useState(new AnimatedRegion({\n      latitude: LATITUDE,\n      longitude: LONGITUDE,\n      latitudeDelta: 0,\n      longitudeDelta: 0\n    })),\n    _useState12 = _slicedToArray(_useState11, 2),\n    coordinate = _useState12[0],\n    setCoordinate = _useState12[1];\n  var getMapRegion = function getMapRegion() {\n    return {\n      latitude: position.coords.latitude,\n      longitude: position.coords.longitude,\n      latitudeDelta: position.coords.latitudeDelta,\n      longitudeDelta: position.coords.longitudeDelta\n    };\n  };\n  var calcDistance = function calcDistance(newLatLng) {\n    return haversine(prevPosition, newLatLng) || 0;\n  };\n  useEffect(function () {\n    setInterval(function () {\n      console.log(\">>> start\");\n      var newPosition = Location.getCurrentPositionAsync({});\n      var _newPosition$coords = newPosition.coords,\n        latitude = _newPosition$coords.latitude,\n        longitude = _newPosition$coords.longitude;\n      var newCoordinates = {\n        latitude: latitude,\n        longitude: longitude\n      };\n      console.log(\"================================================================\");\n      console.log(calcDistance(newCoordinates));\n      if (distanceTraveled == 0 || calcDistance(newCoordinates) >= MIN_DISTANCE) {\n        var temp = JSON.parse(JSON.stringify(position));\n        setPosition(temp);\n        setPosition(newPosition);\n        setRouteCoordinates(routeCoordinates.concat([newCoordinates]));\n        setDistanceTraveled(distanceTraveled + calcDistance(newCoordinates));\n        setCoordinate(new AnimatedRegion(position.coords));\n        console.log(position);\n        console.log(routeCoordinates);\n        console.log(distanceTraveled);\n        console.log(prevPosition);\n        console.log(coordinate);\n      }\n    }, 1000);\n  });\n  return _jsxs(View, {\n    style: styles.container,\n    children: [_jsxs(MapView, {\n      style: styles.map,\n      showsUserLocation: true,\n      followsUserLocation: true,\n      loadingEnabled: true,\n      children: [_jsx(Polyline, {\n        coordinates: routeCoordinates,\n        strokeWidth: 5\n      }), _jsx(Marker.Animated, {\n        coordinate: coordinate\n      })]\n    }), _jsx(View, {\n      style: styles.buttonContainer,\n      children: _jsx(TouchableOpacity, {\n        style: [styles.bubble, styles.button],\n        children: _jsxs(Text, {\n          style: {\n            fontSize: 24\n          },\n          children: [parseFloat(distanceTraveled).toFixed(2), \" km\"]\n        })\n      })\n    })]\n  });\n}\nexport default MyMapScreen;","map":{"version":3,"names":["React","useState","useEffect","Component","MapView","Marker","AnimatedRegion","Polyline","PROVIDER_GOOGLE","Location","haversine","styles","StyleSheet","create","container","absoluteFillObject","justifyContent","alignItems","map","bubble","flex","backgroundColor","paddingHorizontal","paddingVertical","borderRadius","latlng","width","button","marginHorizontal","buttonContainer","flexDirection","marginVertical","LATITUDE_DELTA","LONGITUDE_DELTA","LATITUDE","LONGITUDE","MIN_DISTANCE","MyMapScreen","props","position","setPosition","errorMsg","setErrorMsg","routeCoordinates","setRouteCoordinates","distanceTraveled","setDistanceTraveled","prevPosition","setPrevPosition","latitude","longitude","latitudeDelta","longitudeDelta","coordinate","setCoordinate","getMapRegion","coords","calcDistance","newLatLng","setInterval","console","log","newPosition","getCurrentPositionAsync","newCoordinates","temp","JSON","parse","stringify","concat","fontSize","parseFloat","toFixed"],"sources":["/home/tunv/Desktop/Web-App/tracking-location-app-rn/src/screens/TrackingOnMap.jsx"],"sourcesContent":["import React, { useState, useEffect, Component } from \"react\";\nimport {\n\tStyleSheet,\n\tView,\n\tText,\n\tTouchableOpacity,\n\tPlatform,\n\tPermissionsAndroid,\n} from \"react-native\";\nimport MapView, {\n\tMarker,\n\tAnimatedRegion,\n\tPolyline,\n\tPROVIDER_GOOGLE,\n} from \"react-native-maps\";\nimport * as Location from \"expo-location\";\nimport haversine from \"haversine\";\n\nconst styles = StyleSheet.create({\n\tcontainer: {\n\t\t...StyleSheet.absoluteFillObject,\n\t\tjustifyContent: \"flex-end\",\n\t\talignItems: \"center\",\n\t},\n\tmap: {\n\t\t...StyleSheet.absoluteFillObject,\n\t},\n\tbubble: {\n\t\tflex: 1,\n\t\tbackgroundColor: \"rgba(255,255,255,0.7)\",\n\t\tpaddingHorizontal: 18,\n\t\tpaddingVertical: 12,\n\t\tborderRadius: 20,\n\t},\n\tlatlng: {\n\t\twidth: 200,\n\t\talignItems: \"stretch\",\n\t},\n\tbutton: {\n\t\twidth: 80,\n\t\tpaddingHorizontal: 12,\n\t\talignItems: \"center\",\n\t\tmarginHorizontal: 10,\n\t},\n\tbuttonContainer: {\n\t\tflexDirection: \"row\",\n\t\tmarginVertical: 20,\n\t\tbackgroundColor: \"transparent\",\n\t},\n});\n\nconst LATITUDE_DELTA = 0.009;\nconst LONGITUDE_DELTA = 0.009;\nconst LATITUDE = 37.78825;\nconst LONGITUDE = -122.4324;\nconst MIN_DISTANCE = 0.05;\n\nfunction MyMapScreen(props) {\n\tconst [position, setPosition] = useState(null);\n\tconst [errorMsg, setErrorMsg] = useState(null);\n\tconst [routeCoordinates, setRouteCoordinates] = useState([]);\n\tconst [distanceTraveled, setDistanceTraveled] = useState(0);\n\tconst [prevPosition, setPrevPosition] = useState({});\n\tconst [coordinate, setCoordinate] = useState(\n\t\tnew AnimatedRegion({\n\t\t\tlatitude: LATITUDE,\n\t\t\tlongitude: LONGITUDE,\n\t\t\tlatitudeDelta: 0,\n\t\t\tlongitudeDelta: 0,\n\t\t})\n\t);\n\n\t// Set coordinates of the region\n\tconst getMapRegion = () => ({\n\t\tlatitude: position.coords.latitude,\n\t\tlongitude: position.coords.longitude,\n\t\tlatitudeDelta: position.coords.latitudeDelta,\n\t\tlongitudeDelta: position.coords.longitudeDelta,\n\t});\n\n\t// Calculate distance between previous and current position\n\tconst calcDistance = (newLatLng) => {\n\t\treturn haversine(prevPosition, newLatLng) || 0;\n\t};\n\n\t// Request permission right after starting the app\n\tuseEffect(() => {\n\t\tsetInterval(() => {\n\t\t\tconsole.log(\">>> start\");\n\t\t\t// Get current position\n\t\t\tlet newPosition = Location.getCurrentPositionAsync({});\n\t\t\tconst { latitude, longitude } = newPosition.coords;\n\t\t\tconst newCoordinates = {\n\t\t\t\tlatitude,\n\t\t\t\tlongitude,\n\t\t\t};\n\n\t\t\tconsole.log(\n\t\t\t\t\"================================================================\"\n\t\t\t);\n\t\t\tconsole.log(calcDistance(newCoordinates));\n\n\t\t\t// Check re-rendering screens when agent moves\n\t\t\tif (\n\t\t\t\tdistanceTraveled == 0 ||\n\t\t\t\tcalcDistance(newCoordinates) >= MIN_DISTANCE\n\t\t\t) {\n\t\t\t\t// Set current values\n\t\t\t\tlet temp = JSON.parse(JSON.stringify(position));\n\t\t\t\tsetPosition(temp);\n\t\t\t\tsetPosition(newPosition);\n\t\t\t\tsetRouteCoordinates(routeCoordinates.concat([newCoordinates]));\n\t\t\t\tsetDistanceTraveled(distanceTraveled + calcDistance(newCoordinates));\n\n\t\t\t\tsetCoordinate(new AnimatedRegion(position.coords));\n\n\t\t\t\t// Log values\n\t\t\t\tconsole.log(position); // Not null\n\t\t\t\tconsole.log(routeCoordinates); // Not null\n\t\t\t\tconsole.log(distanceTraveled); // Not null\n\t\t\t\tconsole.log(prevPosition); // Not null\n\t\t\t\tconsole.log(coordinate); // Not null\n\t\t\t}\n\t\t}, 1000);\n\t});\n\n\treturn (\n\t\t<View style={styles.container}>\n\t\t\t<MapView\n\t\t\t\tstyle={styles.map}\n\t\t\t\tshowsUserLocation={true}\n\t\t\t\tfollowsUserLocation={true}\n\t\t\t\tloadingEnabled={true}\n\t\t\t\t// region={getMapRegion()}\n\t\t\t>\n\t\t\t\t<Polyline coordinates={routeCoordinates} strokeWidth={5} />\n\t\t\t\t<Marker.Animated coordinate={coordinate} />\n\t\t\t</MapView>\n\t\t\t<View style={styles.buttonContainer}>\n\t\t\t\t<TouchableOpacity style={[styles.bubble, styles.button]}>\n\t\t\t\t\t<Text style={{ fontSize: 24 }}>\n\t\t\t\t\t\t{parseFloat(distanceTraveled).toFixed(2)} km\n\t\t\t\t\t</Text>\n\t\t\t\t</TouchableOpacity>\n\t\t\t</View>\n\t\t</View>\n\t);\n}\n\nexport default MyMapScreen;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}